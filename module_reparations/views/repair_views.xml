<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>

      <!-- INHERITED FORM VIEW -->
        <record model="ir.ui.view" id="view_repair_form_inherited">
          <field name="name">Repair Form View Inherited</field>
          <field name="model">mrp.repair</field>
          <field name="inherit_id" ref="mrp_repair.view_repair_order_form" />
          <field name="arch" type="xml">

            <xpath expr="//label[@for='name']" position="before">
              <div class="oe_button_box" name="button_box">
                <button name="open_task_line" type="object"
                  string="Tâche Associée"
                  class="oe_stat_button" icon="fa-list-alt"
                  attrs="{'invisible': [('state', '=', 'draft')]}" >
                </button>
              </div>
            </xpath>

            <xpath expr="//field[@name='name']" position="attributes">
              <attribute name="attrs">{'readonly': True}</attribute>
            </xpath>

            <xpath expr="//field[@name='guarantee_limit']" position="after">
              <field name="date_start"/>
              <field name="end_date"/>
            </xpath>

            <xpath expr="//field[@name='address_id']" position="after">
              <field name="clientsite"
                attrs="{'readonly': [('state', '!=', 'draft')]}" />
              <field name="tech"
                attrs="{'invisible': [('clientsite', '=', False)],
                'required': [('clientsite', '=', True)],
                'readonly': [('state', '!=', 'draft')] }" />
            </xpath>

            <xpath expr="//field[@name='location_id']" position="attributes">
              <attribute name="string">Emplacement Actuel (auto)</attribute>
            </xpath>

            <xpath expr="//field[@name='location_dest_id']" position="attributes">
              <attribute name="string">Emplacement de Livraison (auto)</attribute>
            </xpath>

            <xpath expr="//field[@name='operations']/tree//field[@name='location_id']" position="attributes">
              <attribute name="readonly">True</attribute>
            </xpath>

            <xpath expr="//field[@name='operations']/tree//field[@name='location_dest_id']" position="attributes">
              <attribute name="readonly">True</attribute>
            </xpath>

          </field>
        </record>

        <!-- CALENDAR POPUP VIEW -->
        <!-- important to set the priority to 2 so it doesn't override the view_repair_form_inherited -->
        <!-- 
                    <field name="tech" attrs="{'invisible': [('clientsite', '!=', False)]}" />
        <div name="button_box" position="inside">
        <button name="106" type="action" icon="fa-sitemap" class="oe_stat_button" attrs="{'invisible': [('product_variant_count', '&lt;=', 1)]}" groups="product.group_product_variant">
        <field string="Variants" name="product_variant_count" widget="statinfo"/>
        </button>
        </div>
        <record model="ir.ui.view" id="calendar_popup">
        <field name="name">Beraud Calendar Popup</field>
        <field name="model">mrp.repair</field>
        <field name="arch" type="xml">
          <form string="Reparation">
            <field name="date_start" />
          </form>
        </field>
        </record>
        -->

        <!-- CALENDAR VIEW -->
        <record model="ir.ui.view" id="view_repair_calendar_inherited">
            <field name="name">Repair Calendar View Inherited</field>
            <field name="model">mrp.repair</field>
            <field name="arch" type="xml">
                <calendar string="Calendrier des Reparations" color="state"
                    date_start="date_start"
                    date_stop="end_date"
                    create="False"
                    quick_add="False">
                    <field name="name"/>
                    <field name="date_start"/>
                </calendar>
            </field>
        </record>

        <!-- TREE VIEW -->
        <!-- works fine, but not needed 
        <record model="ir.ui.view" id="view_tree_inherited">
          <field name="name">Repair Tree View</field>
          <field name="model">mrp.repair</field>
          <field name="inherit_id" ref="mrp_repair.view_repair_order_tree" />
          <field name="type">form</field>
          <field name="arch" type="xml">
            <tree position="attributes">
              <attribute name="colors">red:state=='draft'</attribute>
            </tree>
          </field>
        </record> -->

        <!-- ACTION -->
        <!-- id format important to override mrp.repair original action.. -->
        <record id="mrp_repair.action_repair_order_tree" model="ir.actions.act_window">
            <field name="name">Reparations</field>
            <field name="res_model">mrp.repair</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,calendar</field>
        </record>

    </data>
</openerp>

