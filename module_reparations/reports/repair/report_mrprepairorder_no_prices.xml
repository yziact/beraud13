<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>
        <template id="report_no_prices">
            <t t-name="report_no_prices">
                <t t-call="report.html_container">
                    <t t-foreach="docs" t-as="o">
                        <t t-call="report.external_layout">
                            <div class="page" style="font-size:11px;">
                                <div class="oe_structure"/>
                                <div class="row">
                                    <div class="col-xs-6 col-xs-offset-6">
                                        <div t-if="o.address_id">
                                            <div t-field="o.address_id"
                                                 t-field-options='{"widget": "contact", "fields": ["address", "name", "phone", "fax"], "no_marker": true, "phone_icons": true}'/>
                                        </div>
                                    </div>
                                </div>

                                <h3>
                                    <span t-if="o.state != 'draft'">Ordre d'Intervention # </span>
                                    <span t-if="o.state == 'draft'">Ordre d'Intervention # </span>
                                    <span t-field="o.name" />
                                </h3>

                                <h6>
                                    <div>
                                        <span t-if="o.contact"> <strong>A l'attention de :</strong> <span t-field="o.contact.title.shortcut"/> <span t-field="o.contact.name"/> / <span t-field="o.contact.phone"/> / <span t-field="o.contact.email"/> </span>
                                    </div>
                                    <!--<strong>Ref. Client : </strong>
                                    <span t-field="o.partner_id.ref"/>-->
                                </h6>


                                <h4>
                                    <strong>Intervention :</strong> <span t-if="o.titre" t-field="o.titre"/>
                                </h4>
                                <table id="cart" class="table table-condensed table-bordered">
                                    <style>
                                        #cart {
                                        border:1px solid black;
                                        border-spacing: 0.5rem;
                                        border-collapse: collapse;
                                        margin-bottom: 20px;
                                        //background-color: red;
                                        }
                                        #cart td {
                                        border:1px solid black;
                                        padding-top: 5px;
                                        padding-right: 5px;
                                        padding-left: 5px;
                                        }
                                        #cart th {
                                        padding: 5px;
                                        border:1px solid black;
                                        background-color: #bebebe;
                                        }
                                        #cart table th { border: none; }
                                        #cart table td { border: none; }
                                    </style>
                                    <thead>
                                        <tr>
                                            <th>
                                                <strong>Date</strong>
                                            </th>
                                            <th>
                                                <strong>V/Ref</strong>
                                            </th>
                                            <th>
                                                <strong>Produit à Réparer : </strong>
                                            </th>
                                            <th>
                                                <strong> Numéro de Série : </strong>
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>
                                                <p t-field="o.date_start" t-field-options='{"format":"dd/MM/y"}'/>
                                            </td>
                                            <td>
                                                <span t-field="o.client_order_ref"/>
                                            </td>
                                            <td>
                                                <span t-field="o.product_id.name"/>
                                            </td>
                                            <td>
                                                <span t-field="o.lot_id.name"/>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>

                                <h4 style="font-weight: bold;">Liste des Pièces</h4>

                                <table class="table table-condensed">
                                    <thead>
                                        <tr>
                                            <th></th>
                                            <th class="text-right">Quantité</th>
                                            <th class="text-right">Source</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <t t-if="o.operations">
                                            <tr t-foreach="o.operations" t-as="line">

                                                <td>
                                                    <p t-if="line.type == 'add'"><i>(Ajouter)</i> <span t-field="line.name" /></p>
                                                    <p t-if="line.type == 'remove'">(<i>Supprimer</i>) <span t-field="line.name"/></p>
                                                </td>

                                                <td class="text-right">
                                                    <span t-field="line.product_uom_qty"/>
                                                    <span groups="product.group_uom" t-field="line.product_uom.name"/>
                                                </td>
                                                <td class="text-right" t-if="o.company_id.id == 1">
                                                    <span t-field="line.product_id.emplacement"/>
                                                </td>
                                                <td class="text-right" t-if="o.company_id.id == 3">
                                                    <span t-field="line.product_id.emplacement_atom"/>
                                                </td>

                                            </tr>
                                        </t>
                                        <t t-if="o.fees_lines">
                                            <tr t-foreach="o.fees_lines" t-as="fees">
                                                <t t-if="fees.to_invoice is True">
                                                    <td>
                                                        <span t-field="fees.name"/>
                                                    </td>

                                                    <td class="text-right">
                                                        <span t-field="fees.product_uom_qty"/>
                                                        <span groups="product.group_uom" t-field="fees.product_uom.name"/>
                                                    </td>

                                                </t>
                                            </tr>
                                        </t>
                                    </tbody>
                                </table>


                                <p t-if="o.state == 'draft'">Toutes les pièces supplémentaires utilisées suite au
                                    démontage seront facturées en plus, ainsi que les heures de main d'oeuvre
                                    supplémentaires.
                                </p>

                                <t t-if="o.task_id and o.state in ['to_sign','2binvoiced','done']">
                                    <h4 style="font-weight: bold;">Détail des Opérations</h4>
                                    <p t-field="o.task_id.description"/>

                                    <br/>
                                    <table class="table table-condensed">
                                        <thead>
                                            <tr></tr>
                                            <tr>
                                                <th>Date</th>
                                                <th class="text-right">Durée</th>
                                            </tr>
                                        </thead>
                                        <tbody class="invoice_tbody">
                                            <t t-foreach="o.get_dict_time()" t-as="l">
                                                <tr>
                                                    <td colspan="5"><strong><t t-esc="l.name"/></strong></td>
                                                </tr>
                                                <tr t-foreach="o.get_dict_time()[l]" t-as="time">
                                                    <td style="width:10%;">
                                                        <span t-esc="time.date" t-field-options='{"format":"dd/MM/y"}'/>
                                                    </td>

                                                    <td style="width:5%;" class="text-right">
                                                        <span t-esc="'%02d:%02d' % (int(str(time.unit_amount).split('.')[0]), int(float(str('%.2f' % time.unit_amount).split('.')[1])/100*60))"/>
                                                    </td>
                                                </tr>
                                            </t>

                                        </tbody>
                                    </table>
                                </t>

                                <p t-field="o.internal_notes"/>
                                <div class="oe_structure"/>

                                <div class="row">
                                    <div class="col-xs-3 col-xs-offset-8" style="margin-top: 50px;">
                                        <p> Date et signature du client : </p>
                                    </div>
                                </div>

                                <div style="position:absolute;left:45%;top:1000px;">
                                    <div style="position:relative;left:-50%;">
                                        <p>Sur demande de votre part une copie de cet ordre d'intervention pourra être joint à la facture.</p>
                                    </div>
                                </div>

                            </div>
                        </t>
                    </t>
                </t>
            </t>
        </template>
    </data>
</openerp>

